<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام الامتحان</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8f8f8;
            margin: 0;
            padding: 20px;
        }

        .hidden { display: none; }

        /* نموذج التسجيل */
        form {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        input, select, button {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background: #4CAF50;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }

        /* الأسئلة */
        .question {
            background: #fff;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }

        .question-text {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .option {
            display: block;
            padding: 5px;
            background: #f0f0f0;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
        }

        .option input {
            margin-left: 10px;
        }

        /* النتيجة */
        .results {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<h2>تسجيل بيانات الطالب</h2>
<form id="student-form">
    <div class="form-group">
        <label for="student-name">اسم الطالب:</label>
        <input type="text" id="student-name" required>
    </div>

    <div class="form-group">
        <label for="student-id">رقم الهوية:</label>
        <input type="text" id="student-id" required>
        <div class="muted">يُقبل أرقام إنجليزية (سيتم تحويل الأرقام العربية تلقائيًا).</div>
    </div>

    <div class="form-group">
        <label for="level">المستوى:</label>
        <select id="level" required>
            <option value="">اختر المستوى</option>
            <option value="1">المستوى الأول</option>
            <option value="2">المستوى الثاني</option>
        </select>
    </div>

    <div class="form-group">
        <label for="course">الدورة:</label>
        <select id="course" required>
            <option value="">اختر الدورة</option>
            <option value="networks">شبكات</option>
            <option value="HR">موارد بشرية</option>
        </select>
    </div>

    <button type="submit">بدء الامتحان</button>
</form>

<div id="exam-section" class="hidden">
    <h2>الامتحان</h2>
    <div id="questions-container"></div>
    <button id="next-button">التالي</button>
</div>

<div id="results-section" class="hidden">
    <h2>النتيجة</h2>
    <div id="results"></div>
</div>

<script>
    const sheetURL = "رابط_CSV_من_Google_Sheets"; // ضع رابط الشيت هنا
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;

    document.getElementById("student-form").addEventListener("submit", async function(e){
        e.preventDefault();

        // تحميل الأسئلة
        await fetchQuestions();

        // عرض أول سؤال
        document.getElementById("student-form").classList.add("hidden");
        document.getElementById("exam-section").classList.remove("hidden");
        renderQuestion();
    });

    async function fetchQuestions() {
        try {
            const res = await fetch(sheetURL);
            const data = await res.text();
            const rows = data.split("\n").slice(1);
            questions = rows.map(row => {
                const cols = row.split(",");
                return {
                    question: cols[0],
                    options: [cols[1], cols[2], cols[3], cols[4]],
                    correctAnswer: parseInt(cols[5])
                };
            }).filter(q => q.question);
        } catch (err) {
            console.error("خطأ في تحميل الأسئلة:", err);
        }
    }

    function renderQuestion() {
        const container = document.getElementById("questions-container");
        container.innerHTML = "";
        if (currentQuestionIndex < questions.length) {
            const q = questions[currentQuestionIndex];
            const qDiv = document.createElement("div");
            qDiv.className = "question";
            qDiv.innerHTML = `
                <div class="question-text">${q.question}</div>
                ${q.options.map((opt, i) => `
                    <label class="option">
                        <input type="radio" name="answer" value="${i}">
                        ${opt}
                    </label>
                `).join("")}
            `;
            container.appendChild(qDiv);
        } else {
            showResults();
        }
    }

    document.getElementById("next-button").addEventListener("click", () => {
        const selected = document.querySelector("input[name='answer']:checked");
        if (selected) {
            if (parseInt(selected.value) === questions[currentQuestionIndex].correctAnswer) {
                score++;
            }
            currentQuestionIndex++;
            renderQuestion();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
            alert("اختر إجابة أولاً");
        }
    });

    function showResults() {
        document.getElementById("exam-section").classList.add("hidden");
        document.getElementById("results-section").classList.remove("hidden");
        document.getElementById("results").innerHTML = `عدد الإجابات الصحيحة: ${score} من ${questions.length}`;
    }
</script>

</body>
</html>
